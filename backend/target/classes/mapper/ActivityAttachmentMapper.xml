<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.club.management.mapper.ActivityAttachmentMapper">

    <!-- 结果映射 -->
    <resultMap id="AttachmentResultMap" type="com.club.management.entity.ActivityAttachment">
        <id column="id" property="id"/>
        <result column="activity_id" property="activityId"/>
        <result column="file_name" property="fileName"/>
        <result column="original_name" property="originalName"/>
        <result column="file_path" property="filePath"/>
        <result column="file_size" property="fileSize"/>
        <result column="file_type" property="fileType"/>
        <result column="file_ext" property="fileExt"/>
        <result column="upload_by" property="uploadBy"/>
        <result column="upload_time" property="uploadTime"/>
        <result column="description" property="description"/>
        <result column="download_count" property="downloadCount"/>
        <result column="upload_by_name" property="uploadByName"/>
    </resultMap>

    <!-- 查询活动的附件列表 -->
    <select id="selectAttachmentListByActivityId" resultMap="AttachmentResultMap">
        SELECT 
            aa.*,
            m.name as upload_by_name
        FROM activity_attachment aa
        LEFT JOIN member m ON aa.upload_by = m.id
        WHERE aa.activity_id = #{activityId}
        ORDER BY aa.upload_time DESC
    </select>

    <!-- 增加下载次数 -->
    <update id="incrementDownloadCount">
        UPDATE activity_attachment
        SET download_count = download_count + 1
        WHERE id = #{id}
    </update>

</mapper>
