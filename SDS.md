本项目旨在解决高校社团日常管理中的痛点，交付一套轻量级的社团管理系统。

### 1. 项目概览与范围
| 类别 | 描述 |
| :--- | :--- |
| **项目目标** | 交付一套“校内网可用、社长可维护、一页就能看懂”的轻量级社团管理系统。 |
| **项目范围** | PC 网页版，仅支持**单社团**管理。 |
| **核心功能** | 社员档案、部门管理、活动管理（含多签审批流）、统计报表、导出交接包。 |
| **技术栈** | **后端:** SpringBoot 2.7 + MyBatisPlus + Swagger3 + JWT   **前端:** Vue2 + VueRouter + Vuex + ElementUI + vue-admin-template |
| **部署环境** | 学校内网局域网（HTTP 协议）。 |


### 2. 角色与权限模型（最终确认版）
| 角色 | 查看全员档案 | 编辑档案 | 查看全部活动 | 创建/编辑活动 | 审批活动 | 导出数据 | 后台管理 | 特殊权限/说明 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **社长** | ✔ | ✔ | ✔ | ✔ | ✔ | ✔ | ✔ | **全权限**，含后台账号管理、部门/角色/晋升调动。 |
| **副社长** | ✔ | ✔ | ✔ | ✔ | ✔ | ✔ | ❌ | 同社长，仅不含“后台账号管理”。 |
| **部长** | ✔ | **仅本部门** | ✔ | ✔ (**负责方**) | ❌ | ✔ | ❌ | **不可**修改成员的部门/角色；活动创建/编辑权限限定为其负责的活动。 |
| **副部长** | ✔ | ❌ | ✔ | ❌ | ❌ | ✔ | ❌ | 仅查看，可导出。 |
| **干事** | **仅自己** | **仅自己** | ✔ | ❌ | ❌ | ❌ | ❌ | 仅查看和编辑自己档案，查看已发布活动。 |
| **指导老师** | ✔ | ❌ | ✔ | ❌ | ✔ | ✔ | ❌ | **仅可审批活动**，**不可**维护社员档案、部门管理、活动参与记录。 |


+ **权限约束确认：** 部长**不能**修改本部门成员的部门和角色字段。所有涉及成员的部门/角色变更（晋升、调动）**只能**由**社长、副社长、指导老师**完成。
+ **档案敏感信息：** 所有拥有“查看全员档案”权限的角色（社长/副社长/部长/副部长/指导老师）均可查看**照片、手机、邮箱**等敏感信息。
+ **账号来源：** 账号在 `member` 表中统一管理，`sys_user` 仅用于保留超管或其他未来多社团扩展。

### 3. 数据模型（核心表调整）
根据多轮确认，核心表结构（使用逻辑外键）调整如下：

| 表名 | 字段（调整/新增部分加粗） | 字段说明 | 索引/约束 |
| :--- | :--- | :--- | :--- |
| `member` | id, stu_id, name, gender, college, major, grade, phone, email, join_date, dept_id, **role** (**中文名**), photo_oss_key, password, create_by, create_time, update_time, **leave****_****date** | **role**：存储中文名称（如“社长”）。   **leave****_****date**：离社时间，用于精确统计历史人数。 | `stu_id` 唯一 |
| `dept` | id, name, sort, **intro** | **intro**：部门简介（VARCHAR 500）。 |  |
| `activity` | id, name, start_time, end_time, location, type, **description**, status【0待审/1通过/2驳回】, reject_reason, **create****_****by** (发起人 id), create_time, update_time | **description**：活动简介（富文本）。   **leader****_****id 字段已移除。** | `start_time` |
| `activity_member` | id, activity_id, member_id, create_time | 活动参与人员记录。 | `activity_id` + `member_id` 联合唯一 |
| `activity_approver` | id, activity_id, user_id (审批人), create_time, **status** (0待审/1通过/2驳回), **approval****_****time** | **新增**：活动与审批人关系表，支持多签流状态记录。 | `activity_id` + `user_id` 联合唯一 |
| `activity_dept` | id, activity_id, dept_id, create_time | **新增**：活动与负责部门关系表，支持多部门负责。 | `activity_id` + `dept_id` 联合唯一 |
| `sys_message` | id, recipient_id, sender_id, title, content, status (0未读/1已读), create_time | **新增**：用于站内信通知，尤其是活动驳回通知。 |  |
| `sys_user` | id, stu_id, name, role, password, status, create_time | **定位：** 仅用于超管账号，与 `member` 分离。 |  |
| `sys_log` | id, operator, operation, method, params, ip, create_time | 关键操作日志。 |  |


### 4. 核心功能与逻辑流程
#### 4.1. 登录与安全
+ **锁定机制：** 登录失败 5 次锁定 30 分钟。**锁定期结束后**，失败计数器立即**重置为 0**。
+ **密码存储：** bcyrpt(10) 存储；JWT 秘钥 256-bit 随机。
+ **角色权限验证：** 不同角色登录后显示不同功能模块，权限控制精确到页面级别。

#### 4.2. 社员档案（数据完整性保障）
+ **批量导入：**
    - **异常处理：** 空学号/重复学号/非法日期（格式不符或 `join_date` 晚于当前日期）标红并阻止导入。
    - **OSS 回滚：** 导入过程中，如照片上传 OSS 成功，但数据库事务失败，必须实现 OSS 回滚机制，自动删除已上传的文件。
    - **详细说明：** 提供完整的导入步骤说明，提醒用户删除模板中的"说明"部分。
+ **照片维护（OSS 清理）：**
    - 上传新照片时，必须删除对应的旧照片 OSS 对象。
    - 手动删除照片（清空字段）时，必须删除对应的 OSS 对象。
+ **必填项标注：** 姓名、性别、学院、专业、年级、手机号等关键字段标注为必填。

#### 4.3. 部门管理
+ **部门删除校验：** 仅校验 `member` 表中无成员关联。**不考虑** `activity_dept` 历史活动记录。
+ **部门信息：** 新增 `intro` 字段，支持"卡片视图"展示。
+ **部门详情页：** 展示成员列表和相关活动，支持部门简介编辑。

#### 4.4. 活动管理（多签审批流）
+ **负责方：** `activity_dept` 表记录负责部门，由创建者确定。
+ **审批流（多签）：**
    1. **审批人：** 限制为指导老师或社长，由创建者多选，记录在 `activity_approver` 表。
    2. **通过逻辑：** 状态必须是 **所有** `activity_approver.status` 均为 `1`（通过），活动状态才变为"已通过"。
    3. **驳回逻辑：** **任意一位**审批人选择了**驳回**，活动状态应**立即**变为"已驳回"，并终止其他审批人的流程。
    4. **进度展示：** 在**活动详情页**的"审批面板"中，展示 `activity_approver` 表中每位审批人的"XXX 已通过/XX 未通过"状态。
+ **驳回通知（站内信）：**
    - 实现方式：新增 `sys_message` 表持久化通知，前端导航栏通过红点提醒用户。
+ **活动参与管理：**
    - **报名功能：** 支持活动报名和取消报名，报名状态实时跟踪。
    - **参与人员管理：** 支持添加/移除成员，搜索选择功能。
    - **数据持久化：** 确保参与人员数据正确保存和删除，避免数据不一致。

#### 4.5. 统计与导出
+ **活动出勤率（应到人数）：**
    - **定义：** `参与人数 / 应到人数`。
    - **计算：** **应到人数** = 活动**开始时间点**的 `member` 表总记录数（需排除 `leave_date` 早于活动开始时间或 `status=禁用` 的成员）。
+ **导出交接包：**
    - **PDF 内容：** 仅展示活动的基本信息（名称、时间、地点、类型、负责人、参与人名单）的**列表**，不含富文本简介或附件照片。
    - **OSS 安全：** 下载链接 1 小时内有效，OSS 直链不暴露真实路径，下载后 OSS 对象可选择销毁或设置过期时间。
+ **仪表盘数据一致性：** 确保卡片数据与列表数据保持一致，实时更新统计信息。

#### 4.6. 个人中心
+ **基本信息编辑：** 支持姓名、手机、邮箱等字段编辑。
+ **必填项标注：** 姓名、性别、学院、专业、年级、手机号等关键字段标注为必填。
+ **密码修改：** 支持密码修改功能，确保账户安全。

### 5. 接口命名规范与错误码（不变）
（遵循 PRD 第 8、9 条）

### 6. 前端交互与界面规则（关键点）
+ **列表空态/删除操作/Toast 规则：** 遵循 PRD 第 6 条规定。
+ **分页参数：** 保存在 URL query，刷新保持页码与筛选条件。
+ **仪表盘：** 按角色展示不同的统计卡片、分布图（使用 ECharts）和快捷入口。
+ **个人中心：** 仅可编辑姓名、邮箱、手机号；部门/角色只读。
+ **审批进度展示：** 详情页审批面板展示（见 4.4）。

