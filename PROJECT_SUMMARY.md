# 社团管理系统 - 项目开发进度总结

## 项目概述

社团管理系统是一个基于Spring Boot + Vue2技术栈开发的完整Web应用，专为高校社团日常管理设计。系统实现了成员管理、活动管理、部门管理、数据导出、活动附件等核心功能，采用基于角色的权限控制，支持多种用户角色和细粒度权限管理，解决了传统Excel管理方式的痛点。

## 活动附件功能 (2025-01-25)

### 功能概述
活动附件功能允许用户为活动上传、管理附件文件，包括文件上传、下载、预览、删除等功能。

### 数据库设计
- **表名**：`activity_attachment`
- **字段**：id, activity_id, file_name, original_name, file_path, file_size, file_type, file_ext, upload_by, upload_time, description, download_count
- **索引**：activity_id, upload_by

### 实现特性
- 支持Office文档、PDF、图片、压缩包等多种文件类型
- 单个文件大小限制：10MB
- 本地文件存储，路径格式：`uploads/activity/{activityId}/{year}/{month}/{uuid}.{ext}`
- 权限控制：活动创建者、社长、副社长、部长（自己创建的活动）可以上传和删除
- 文件预览：支持图片和PDF在线预览

### 已修复问题
- 修复了404错误（Controller路径重复）
- 修复了500错误（数据库缺少表）
- 修复了文件路径错误（使用绝对路径）
- 修复了Vue 2兼容性问题（移除可选链操作符）
- 修复了下载文件undefined问题（响应拦截器处理blob响应）
- 修复了上传后列表不刷新问题（添加刷新机制）
- 修复了删除按钮不显示问题（添加canDelete字段）

## 数据库结构最终版本

### 核心表结构
- `dept`：部门表，包含部门名称、简介等信息
- `member`：成员表，包含学号、姓名、部门、角色等完整信息
- `activity`：活动表，包含活动名称、时间、地点、类型、状态等
- `activity_approver`：活动审批人表，支持多签审批流程
- `activity_member`：活动参与人员表，记录活动参与人员
- `activity_dept`：活动负责部门表，支持多部门负责
- `activity_attachment`：活动附件表，支持文件上传和管理
- `sys_user`：系统用户表，用于超管账号
- `sys_log`：系统日志表，记录关键操作日志

### 重要变更
1. **删除了签到功能相关字段**：`activity.sign_method` 和 `activity_member.attendance_status`
2. **保留了附件字段**：`activity.attachments` (JSON类型)
3. **通过关系表存储负责部门**：使用 `activity_dept` 表
4. **添加了活动附件表**：`activity_attachment` 表支持完整的文件管理功能

### 字段类型说明
- `member.grade`：VARCHAR(20)，不是ENUM
- `activity.attachments`：JSON类型，Java中存储为String
- `activity.status`：TINYINT类型，不是INT
- `activity_approver.status`：TINYINT类型，不是INT
- `activity_member.signup_status`：TINYINT类型，不是INT

## 最新更新 (2024年12月25日)

### 功能修复与完善
1. **活动附件表格优化**
   - 修复图片类型"删除"按钮宽度问题，设置固定宽度60px
   - 将删除按钮放入独立的flex容器，保持布局整洁
   - 保持其他按钮位置不变

2. **导出功能全面优化**
   - 修复Excel导出数据序列化问题，添加`getStringValue`辅助方法
   - 修复ZIP文件下载的MIME类型和字符编码设置
   - 修复活动详情导出功能的数据处理问题
   - 优化前端下载逻辑，正确处理blob响应数据
   - 添加response.flush()确保数据完整传输
   - 根据文件格式动态设置正确的MIME类型
   
3. **导出功能业务逻辑完善**
   - **部门信息导出**：
     - 删除"部门ID"列
     - "负责人"列显示部长姓名
     - "联系方式"列显示部长电话号码
     - 不支持时间范围筛选
   - **成员信息导出**：
     - 支持部门多选筛选
     - 部长和副部长只能导出本部门成员
     - 社长、副社长、指导老师可以导出全部成员
     - 不支持时间范围筛选
   - **活动信息导出**：
     - 支持时间范围筛选
     - 筛选逻辑：开始时间和结束时间都在范围内
   
4. **导出UI交互优化**
   - 动态显示/隐藏时间范围选择器（单选活动信息或多选包含活动信息时显示）
   - 动态显示/隐藏部门选择器（单选成员信息或多选包含成员信息时显示）
   - 部门选择器添加"全选"和"清空"一键操作按钮
   - 切换导出类型时自动清空上次选择
   - 部长和副部长部门选择器只能看到本部门
   
5. **README文档优化**
   - 多选导出类型时，删去"导出ID"字段
   - 单选导出类型时，保留"导出ID"字段

6. **活动详情导出美化**
   - 添加居中的主标题样式（16号粗体）
   - 基本信息使用表格形式，标签列灰色背景，加边框
   - 参与人员表格添加完整的表头样式（灰色背景、加粗、居中）
   - 所有单元格添加边框和合适的列宽
   - 设置文本自动换行，提升可读性

7. **权限控制优化**
   - 副部长和指导老师可以查看社员详情
   - 保留社员管理页面的"详情"按钮，所有角色可见
   - 编辑和删除按钮仅对有权限的角色显示

## 最新更新 (2024年12月)

### 功能完善
1. **后台管理功能完善**
   - 新增社长统一新增账号功能
   - 学号8位格式验证，初始密码=学号后6位
   - 批量创建账号功能

2. **权限控制优化**
   - 完善指导老师权限限制（不可维护社员档案、部门管理、活动参与记录）
   - 加强部长权限控制（不可修改成员的部门/角色）
   - 完善活动参与记录管理权限

3. **活动管理功能增强**
   - 完善多签审批流程，确保所有审批人都通过才变为"已通过"
   - 新增活动审批状态详情API
   - 完善活动状态流转逻辑

4. **导出功能优化**
   - 修改活动信息导出表格，"负责人"列改为"负责部门"列
   - 完善导出权限控制
   - 在活动详情页面添加"数据导出"按钮

5. **用户体验提升**
   - 完善前端和后端数据验证
   - 统一使用el-empty组件显示空数据状态
   - 分页参数保存到URL query中

6. **安全功能完善**
   - 登录失败5次锁定30分钟机制
   - 初始密码=学号后6位的密码策略
   - 完善关键操作日志记录

### 最新修复 (2024年12月24日)
1. **社员管理页面优化**
   - 删除统一新增账号功能，合并到批量导入
   - 完善批量导入说明和验证逻辑
   - 修正排序功能，删除姓名列排序
   - 添加重置按钮

2. **页面修复**
   - 修复社员详情页面活动记录加载失败
   - 修复活动详情页面导出和编辑功能
   - 删除头像显示

3. **功能增强**
   - 完善活动审批权限控制
   - 添加搜索筛选重置功能
   - 修复路由重复导航错误

### 最新完善 (2024年12月24日下午)
1. **排序功能修复**
   - 修复社员管理页面学号和入社时间排序
   - 修复活动管理页面结束时间排序

2. **界面优化**
   - 调整社员管理页面按钮位置
   - 修复电话号码验证正则表达式

3. **功能完善**
   - 完善删除社员功能，同时删除相关记录
   - 修复活动审批人搜索功能
   - 修复活动编辑和导出功能
   - 确保新增社员时学号8位限制和初始密码设置

### 最新修复 (2024年12月24日晚)
1. **社员管理页面**
   - 修复500错误，添加排序参数传递
   - 确保排序功能正常工作

2. **活动编辑页面**
   - 修复审批人搜索功能，支持搜索社长、副社长、指导老师
   - 修复时间格式转换问题

3. **活动导出功能**
   - 修复导出响应处理逻辑
   - 添加调试日志

### 最终修复 (2024年12月24日晚)
1. **数据验证**
   - 修复电话号码验证正则表达式（11位手机号）
   - 设置默认入社时间为当前日期
   - 添加社员详情页面学号8位限制

2. **活动导出功能**
   - 重构导出逻辑，直接生成Excel文件
   - 实现完整的活动详情导出功能
   - 包含活动基本信息和参与人员列表

### 最终完善 (2024年12月24日深夜)
1. **数据验证统一**
   - 在所有社员管理页面添加学号8位验证
   - 统一电话号码验证规则，修复验证不消失问题
   - 改进验证trigger机制

2. **功能完善**
   - 修复活动导出401错误，使用blob下载
   - 修复活动编辑400错误，移除signMethod字段
   - 确保所有新增/编辑社员功能正确实现密码策略

## 技术架构

### 后端技术栈
- **框架**: Spring Boot 2.7.18
- **数据库**: MySQL 8.0
- **ORM**: MyBatis-Plus 3.5.3.1
- **认证**: JWT + Spring Security
- **文档处理**: Apache POI (Excel) + iText (PDF)
- **构建工具**: Maven
- **JDK版本**: JDK 21

### 前端技术栈
- **框架**: Vue 2 + Vue Router + Vuex
- **UI组件**: Element UI
- **HTTP客户端**: Axios
- **图表库**: ECharts
- **样式预处理**: Sass
- **构建工具**: Vue CLI 4

### 测试框架
- **UI自动化测试**: Playwright
- **浏览器支持**: Firefox, Chrome
- **测试报告**: HTML, JSON, JUnit

## 核心功能模块

### 1. 认证系统
- ✅ JWT token认证
- ✅ 多用户类型支持（系统管理员 + 社团成员）
- ✅ 基于角色的权限控制
- ✅ 登录状态保持

### 2. 仪表板
- ✅ 统计数据展示（成员总数、活动数量、待审批等）
- ✅ 图表可视化（部门分布、活动类型统计）
- ✅ 权限相关数据过滤
- ✅ 待审批活动列表
- ✅ 角色权限控制（干事只显示相关卡片）

### 3. 成员管理
- ✅ 成员信息CRUD操作
- ✅ 分页查询和搜索
- ✅ 批量导入导出
- ✅ 基于角色的权限控制
- ✅ 数据隔离（干事只能查看自己，部长只能查看本部门）

### 4. 部门管理
- ✅ 部门信息管理
- ✅ 部门成员统计
- ✅ 部门详情展示
- ✅ 权限控制

### 5. 活动管理
- ✅ 活动创建和编辑
- ✅ 多签审批流程
- ✅ 活动参与管理
- ✅ 活动报名功能
- ✅ 取消报名功能
- ✅ 审批状态跟踪
- ✅ 审批通知系统
- ✅ 权限控制（干事不能创建活动）
- ✅ 参与人员数据持久化
- ✅ 实时数据更新


### 7. 数据导出
- ✅ Excel格式导出
- ✅ PDF格式导出
- ✅ 导出历史管理
- ✅ 文件下载功能

### 8. 个人中心
- ✅ 个人信息编辑
- ✅ 密码修改
- ✅ 个人活动查看
- ❌ 头像上传功能（已移除）

### 9. 响应式设计
- ✅ 桌面端适配
- ✅ 平板端适配
- ✅ 手机端适配
- ✅ 移动端优化

### 10. 文件上传
- ✅ 本地文件存储
- ✅ 文件类型验证
- ✅ 文件大小限制
- ✅ 静态资源访问

## 权限控制体系

### 角色定义
- **社长**: 全权限，可以管理所有功能
- **副社长**: 大部分权限，可以审批活动和管理成员
- **部长**: 部门级权限，只能管理本部门成员
- **副部长**: 查看权限，可以查看本部门数据
- **干事**: 个人权限，只能查看和编辑自己的信息
- **指导老师**: 审批权限，可以审批活动

### 权限实现
- 前端路由权限控制
- 后端API权限验证
- 数据隔离和过滤
- 操作按钮权限控制
- 部长权限控制：部长只能创建和编辑本部门负责的活动，负责部门字段默认显示并固定为本部门
- 防重复提交机制：活动创建时防止重复提交
- 活动报名权限控制：只有已通过的活动才能报名
- 参与人员管理权限：有管理权限的人可以添加参与人员

## 数据库设计

### 核心表结构
- `sys_user`: 系统用户表
- `member`: 社团成员表
- `dept`: 部门表
- `activity`: 活动表
- `activity_member`: 活动参与记录表
- `activity_approver`: 活动审批人表
- `activity_dept`: 活动部门关联表
- `sys_log`: 系统日志表

### 数据关系
- 成员与部门：多对一关系
- 活动与成员：多对多关系
- 活动与审批人：多对多关系
- 活动与部门：多对多关系

## 测试覆盖

### UI自动化测试
- ✅ 登录功能测试
- ✅ 仪表板功能测试
- ✅ 成员管理功能测试
- ✅ 部门管理功能测试
- ✅ 活动管理功能测试
- ✅ 文件上传功能测试
- ✅ 导出功能测试
- ✅ 统计模块测试
- ✅ 权限控制测试
- ✅ 响应式设计测试

### 测试工具
- Playwright自动化测试框架
- 支持Firefox和Chrome浏览器
- 生成HTML测试报告
- 失败测试自动截图和视频录制

## 部署配置

### 后端配置
- 端口: 8081
- 上下文路径: /api
- 数据库: MySQL 8.0
- JWT密钥: 可配置
- 文件上传路径: ./uploads

### 前端配置
- 端口: 5174
- API代理: /api -> http://localhost:8081
- 支持跨域请求
- 静态资源优化

## 项目文件结构

### 后端结构
```
backend/
├── src/main/java/com/club/management/
│   ├── ClubManagementApplication.java
│   ├── common/ (通用类)
│   ├── config/ (配置类)
│   ├── controller/ (控制器)
│   ├── entity/ (实体类)
│   ├── mapper/ (数据访问层)
│   ├── service/ (业务逻辑层)
│   └── dto/ (数据传输对象)
├── src/main/resources/
│   ├── application.yml
│   ├── mapper/ (MyBatis映射文件)
│   └── sql/ (数据库脚本)
└── pom.xml
```

### 前端结构
```
frontend/
├── src/
│   ├── components/ (通用组件)
│   ├── views/ (页面组件)
│   ├── router/ (路由配置)
│   ├── store/ (状态管理)
│   ├── utils/ (工具函数)
│   └── styles/ (样式文件)
├── tests/ (测试文件)
├── public/ (静态资源)
└── package.json
```

## 开发历程

### 主要里程碑
1. **项目初始化**: 搭建Spring Boot + Vue2基础架构
2. **数据库设计**: 根据SDS.md设计数据库表结构
3. **认证系统**: 实现JWT认证和权限控制
4. **核心功能**: 完成成员、部门、活动管理功能
5. **高级功能**: 实现多签审批、数据导出、日志记录
6. **UI优化**: 响应式设计和用户体验优化
7. **测试完善**: 全面的UI自动化测试覆盖
8. **问题修复**: 解决各种技术问题和兼容性问题

### 解决的关键问题
- 数据库Schema与设计文档不一致
- 统一用户认证系统实现
- 权限控制系统完善
- 多签审批流程实现
- 文件上传功能实现
- 统计模块实现
- PDF导出功能实现
- UI自动化测试完整实现
- 活动报名权限控制优化
- 参与人员部门信息显示修复
- 部长创建活动权限控制完善
- 系统界面和功能修复（Echarts图表、批量导入说明、Logo文本、下载功能等）
- 部长编辑活动权限完善
- 数据导出文件下载功能修复
- 个人中心密码修改功能完善
- 批量导入说明显示优化（使用自定义HTML样式，弹窗宽度调整为500px）
- 数据导出返回数据格式处理修复
- 搜索功能优化（只查询member表，不包括sys_user表）
- 批量导入注意事项更新（明确年级选择范围和部门ID参考位置）

## 测试账号

### 系统管理员
- 学号: admin, 密码: password, 角色: 社长

### 社团成员
- 学号: 2021001, 密码: password, 角色: 社长
- 学号: 2021002, 密码: password, 角色: 副社长
- 学号: 2021003, 密码: password, 角色: 部长
- 学号: 2021004, 密码: password, 角色: 副部长
- 学号: 2021005, 密码: password, 角色: 干事
- 学号: 2021006, 密码: password, 角色: 指导老师

## 快速启动

### 后端启动
```bash
cd backend
mvn clean package -DskipTests
java -jar target/club-management-1.0.0.jar
```

### 前端启动
```bash
cd frontend
npm install
npm run serve
```

### 访问地址
- 前端: http://localhost:5174
- 后端API: http://localhost:8081/api

## 项目特色

1. **完整的权限控制**: 基于角色的细粒度权限管理
2. **多签审批流程**: 支持复杂的活动审批流程
3. **响应式设计**: 支持多设备访问
4. **数据可视化**: 集成ECharts图表展示
5. **文件管理**: 支持文件上传和导出
6. **日志系统**: 完整的操作日志记录机制
7. **自动化测试**: 全面的UI自动化测试覆盖
8. **文档完善**: 详细的问题记录和解决方案

## 技术亮点

1. **统一认证**: 支持系统管理员和社团成员两种用户类型
2. **数据隔离**: 不同角色看到不同的数据范围
3. **多签审批**: 实现复杂的多签审批流程
4. **文件处理**: 支持Excel和PDF格式的数据导出
5. **实时统计**: 动态计算和展示各种统计数据
6. **移动适配**: 完整的响应式设计支持
7. **测试驱动**: 全面的自动化测试保证质量

## 后续优化建议

1. **性能优化**: 数据库查询优化、缓存机制
2. **安全增强**: 更严格的输入验证、SQL注入防护
3. **功能扩展**: 更多统计图表、批量操作功能
4. **用户体验**: 更丰富的交互效果、操作提示
5. **部署优化**: Docker容器化、CI/CD流水线
6. **监控告警**: 系统监控、错误日志收集

## 总结

本项目是一个功能完整、技术先进的社团管理系统，实现了从需求分析到系统部署的完整开发流程。系统具有良好的可扩展性和可维护性，代码结构清晰，文档完善，测试覆盖全面。通过本项目的开发，展示了现代Web应用开发的最佳实践，包括前后端分离架构、权限控制、数据可视化、自动化测试等技术要点。


## 项目成果

### 核心功能实现
- ✅ **完整的权限控制体系**：基于角色的细粒度权限管理，支持6种用户角色
- ✅ **多签审批流程**：支持复杂的活动审批流程，确保审批的严谨性
- ✅ **活动参与管理**：完整的报名、取消报名、参与人员管理功能
- ✅ **数据可视化**：集成ECharts图表，提供直观的统计展示
- ✅ **响应式设计**：支持桌面端、平板端、手机端多设备访问
- ✅ **数据导出**：支持Excel和PDF格式的数据导出功能
- ✅ **自动化测试**：全面的UI自动化测试覆盖

### 技术亮点
- **统一认证系统**：支持系统管理员和社团成员两种用户类型
- **数据隔离机制**：不同角色看到不同的数据范围
- **实时数据更新**：确保数据一致性和实时性
- **原子性操作**：数据持久化操作的可靠性保证
- **字段映射优化**：前后端数据字段一致性

### 遗留问题
- ⚠️ **个人中心密码修改**：需要进一步排查环境配置问题
- ⚠️ **数据导出下载**：需要重启后端服务或检查环境配置
