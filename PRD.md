## 1. 项目背景
解决高校社团日常管理痛点： 

+ 社员信息、活动记录、换届交接全靠 Excel，易丢失、难统计 
+ 活动审批无留痕，指导老师无法远程确认 
+ 无权限划分，数据安全隐患大 

**目标**：交付一套“校内网可用、社长可维护、一页就能看懂”的轻量级社团管理系统。

---

## 2. 范围
+ PC 网页版，仅支持单社团 
+ 角色：社长、副社长、部长、副部长、干事、指导老师 
+ 核心功能：社员档案、活动审批、参与记录、导出交接包 

---

## 3. 角色与权限
| 角色 | 权限摘要 |
| :--- | :--- |
| 社长 | 全权限，含后台账号管理 |
| 副社长 | 同社长，仅不含“账号管理” |
| 部长 | 可编辑本部门成员 + 创建/编辑本部门负责的活动 |
| 副部长 | 只读本部门成员，可导出数据 |
| 干事 | 仅查看和编辑自己档案、查看已发布活动 |
| 指导老师 | 可审批活动（通过/驳回），其余同副社长 |


| 角色 | 查看全员档案 | 编辑档案 | 查看全部活动 | 创建/编辑活动 | 审批活动 | 导出数据 | 后台管理 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 社长 | ✔ | ✔ | ✔ | ✔ | ✔ | ✔ | ✔ |
| 副社长 | ✔ | ✔ | ✔ | ✔ | ✔ | ✔ | ✔ |
| 部长 | ✔（本部门可编辑） | 仅本部门 | ✔ | ✔（本部门为负责方） | ❌ | ✔ | ❌ |
| 副部长 | ✔ | ❌ | ✔ | ❌ | ❌ | ✔ | ❌ |
| 干事 | 仅自己 | 仅自己 | ✔ | ❌ | ❌ | ❌ | ❌ |
| 指导老师 | ✔ | ✔ | ✔ | ✔ | ✔ | ✔ | ❌ |


**账号来源**：社长在后管“账号管理”页统一新增，初始密码=学号后 6 位，不强制修改。

---

## 4. 功能需求
### 4.1 登录认证
+ URL：`/login`
+ 字段：学/工号、密码
+ 成功返回 JWT（有效期 24h），失败 5 次锁定 30 分钟
+ 支持角色权限验证，不同角色登录后显示不同功能模块

### 4.2 社员档案管理
#### 4.2.1 单条维护
+ 字段：姓名、性别、学号、学院、专业、年级、手机、邮箱、入社时间、部门、角色、照片
+ 照片上传后立即压缩 ≤500KB，文件名=`{stuId}_{timestamp}.jpg`，存入 OSS
+ 学号全局唯一；重复给出 toast 提示
+ 支持个人档案编辑，必填项标注（姓名、性别、学院、专业、年级、手机号）

#### 4.2.2 批量导入
+ 入口：【社员管理→导入】
+ 提供"下载模板"按钮，列顺序固定（同字段顺序）
+ 每次最多 500 行；导入预览页展示异常行，确认后正式写入
+ 异常处理：空学号/重复学号/非法日期 标红并阻止导入
+ 详细导入步骤说明，提醒用户删除模板中的"说明"部分

#### 4.2.3 列表与查询
+ 默认 10 条/页，可切 20/50
+ 支持按"姓名、学号、部门、角色"组合筛选
+ 点击行进入详情页，展示基本信息 + 参与活动列表（时间倒序）

### 4.3 部门管理
+ 初始化 SQL 插入 4 部门：宣传部、技术部、培训服务部、办公室
+ 社长可在【后台管理→部门设置】增删改名称，删除前校验无成员关联
+ 部门详情页展示成员列表和相关活动
+ 支持部门简介编辑

### 4.4 活动管理
#### 4.4.1 创建/编辑
+ 字段：活动名称、开始时间、结束时间、地点、类型（下拉：例会/比赛/志愿/外出）、负责人（下拉成员）、参与人员（多选）、签到方式（文本 30 字）、附件/照片（可选，多文件≤10M）、活动简介（富文本≤2000 字）
+ 必填项标注：活动名称、活动类型、开始时间、结束时间、审批人、负责部门
+ 保存后状态="待审批"，指导老师审批前仅创建者可编辑

#### 4.4.2 审批流
+ 指导老师登录后顶部导航出现【活动审批】红点数
+ 列表页展示待审批活动，操作列：通过/驳回
+ 驳回必须填写理由（≤200 字），系统发站内信给创建者
+ 支持多人审批，审批状态实时更新

#### 4.4.3 活动列表
+ 筛选项：名称、类型、时间段、负责人、状态（全部/待审批/已通过/已驳回）
+ 已通过活动对所有角色可见；其余仅创建者+社长/副社长/老师可见

#### 4.4.4 参与记录维护
+ 活动详情页展示"参与人"面板，部长及以上可勾选/取消，即时保存
+ 支持活动报名和取消报名功能
+ 参与人员管理：添加/移除成员，支持搜索选择
+ 报名状态跟踪，实时更新参与人员列表

### 4.5 统计与仪表盘
+ 社员维度：总参与次数、最近活跃时间（最新一次活动结束时间）
+ 活动维度：参与人数、出勤率（=参与人数/应到人数，应到=当时社团总人数）
+ 仪表盘数据一致性：卡片数据与列表数据保持一致
+ 按角色显示不同统计信息

### 4.6 导出交接包
+ 入口：【后台管理→换届交接】
+ 一键生成 zip，文件名=`社团档案_{yyyyMMdd_HHmmss}.zip`
+ 含：
    - `社员档案.xlsx`（全字段）
    - `活动记录.xlsx`（字段：名称、时间、地点、类型、负责人、参与人名单）
    - `活动记录.pdf`（带页眉"XX 社团活动汇总"、页脚"生成时间 + 第 X 页/共 Y 页"、落款"XX 社团 + 日期"）
+ 下载链接 1 小时内有效，OSS 直链不暴露真实路径

### 4.7 个人中心
+ URL：`/profile`
+ 内容：基本信息（姓名、手机、邮箱、部门、角色、头像）查看/编辑
+ 必填项标注：姓名、性别、学院、专业、年级、手机号
+ 支持密码修改功能

---

## 5. 非功能需求
| 类别 | 要求 |
| :--- | :--- |
| 性能 | 单表 1 万条数据，列表查询 ≤800 ms |
| 安全 | 密码 bcyrpt(10) 存储；JWT 秘钥 256-bit 随机；OSS 使用 RAM 最小权限 |
| 兼容 | Chrome ≥90、Edge ≥90、Firefox ≥90 |
| 网络 | 仅校内局域网，HTTP 即可 |
| 备份 | 数据库每日凌晨 3 点 mysqldump，保留 7 天 |
| 日志 | 关键操作（登录、审批、导出、删成员）写表 `sys_log`，保留 180 天 |


---

## 6. 界面规则
+ 侧栏三级菜单深度以内，图标用 ElementUI 官方
+ 列表空数据统一用 `el-empty` 描述“暂无数据”
+ 所有删除操作需二次 confirm
+ Toast 持续时间 3s；成功绿色，失败红色
+ 分页参数保存在 URL query，刷新保持页码

---

## 7. 数据库概览（核心表）
```plain
member(id, stu_id, name, gender, college, major, grade, phone, email, join_date, dept_id, role, photo_oss_key, password, create_by, create_time, update_time)

dept(id, name, sort)

activity(id, name, start_time, end_time, location, type, leader_id, description, status【0待审/1通过/2驳回】, reject_reason, create_by, create_time, update_time)

activity_member(id, activity_id, member_id, create_time)

sys_user(id, stu_id, name, role, password, status, create_time)  ← 保留超管账号，与 member 分离，便于以后多社团

sys_log(id, operator, operation, method, params, ip, create_time)
```

外键均逻辑外键，便于批量删除。 

索引：member.stu_id 唯一；activity.start_time；activity_member.activity_id+member_id 联合唯一。

---

## 8. 接口命名规范
`/{模块}/{子模块}/{动作}`

GET 查询 / POST 新增 / PUT 全量更新 / PATCH 部分更新 / DELETE 删除 

例： 

`GET /member/page`

`POST /member/import`

`PUT /activity/approve/{id}`

`GET /export/transition` → 返回 zip 下载 URL

---

## 9. 错误码
| 代码 | 含义 |
| :--- | :--- |
| 200 | 成功 |
| 4001 | 学号已存在 |
| 4002 | 活动已审批通过，不可修改 |
| 4003 | 部门下仍有成员 |
| 401 | 未登录或 token 过期 |
| 403 | 权限不足 |
| 500 | 系统异常 |


---

## 10. 版本计划
| 里程碑 | 时间 | 交付 |
| :--- | :--- | :--- |
| M1 | T + 3 天 | 数据库 + SpringBoot 基础框架 + Swagger 在线文档 |
| M2 | T + 7 天 | 登录、社员模块（含导入）、部门管理 |
| M3 | T + 12 天 | 活动模块（含审批）、参与记录、统计 |
| M4 | T + 15 天 | 导出交接包、OSS 对接、前端联调完成 |
| M5 | T + 18 天 | 内网部署、验收通过、文档移交 |


---

## 11. 技术栈
后端：SpringBoot 2.7 + MyBatisPlus + Swagger3 + JWT

前端：Vue2 + VueRouter + Vuex + ElementUI + vue-admin-template

工具：IDEA + VSCode + Maven + npm

部署：学校内网


---

## 12. 前端交互与页面更新（新增）

### 12.1 列表页（部门/社员/活动）
- 搜索/筛选/排序条置于页面顶部：
  - 部门：关键字（名称）、排序（升/降）。
  - 社员：姓名、学号、部门、角色，排序字段（入社时间/姓名/学号）。
  - 活动：名称、类型（例会/比赛/志愿/外出）、时间段、负责人、状态（待审批/通过/驳回），排序字段（开始时间/创建时间）。
- 新增入口移动到页面右上角按钮「新增」，点击后进入：
  - 推荐弹窗表单；字段按各模块“新增字段”规范执行；校验与后端一致。
- 列表空态统一使用 `el-empty`，删除操作二次确认。

### 12.2 仪表盘（按角色展示）
- 系统管理员（社长/副社长）：
  - 用户统计卡片：总人数、在职/禁用、最近活跃数。
  - 活动统计卡片：近30天活动数、通过率、参与人次。
  - 分布图：成员按部门分布、活动类型分布（饼图/柱状图）。
  - 待审批活动列表（指导老师亦可见）。
  - 快捷入口：发布新活动、成员导入、部门设置、审批中心。
- 干事：
  - 我已报名活动（即将开始优先）。
  - 可参与活动（筛掉与我无关/已结束）。
- 其他角色（部长/副部长/指导老师）：
  - 依据权限展示“我的活动”“待审批活动”“本部门成员概览”等子集。

### 12.3 个人中心
- URL：`/profile`
- 内容：基本信息（姓名、手机、邮箱、部门、角色、头像）查看/编辑；
- 行为：修改前需校验字段合法性，保存成功后刷新本地用户信息；头像后续接入 OSS（当前为占位）。

### 12.4 通用交互补充
- 右上角统一放置「新增」「导出」「筛选」等主要操作；
- Toast 成功/失败统一 3s；分页参数保存在 URL query，刷新保持页码与筛选条件。

### 12.5 后端接口适配（若需）
- 列表分页接口新增/支持以下查询参数：
  - 成员：`name`、`stuId`、`deptId`、`role`、`sortField`、`sortOrder`。
  - 活动：`name`、`type`、`status`、`leaderId`、`startTime`、`endTime`、`sortField`、`sortOrder`。
- 返回值不变，仍为统一 `Result` 包裹；分页内含 `records/total`。

### 12.6 约束与确认（用户已确认）
- 搜索/排序字段：固定为本 PRD 列出项；文本类支持模糊匹配（LIKE）。
- 个人中心可编辑字段：姓名、邮箱、手机号；部门/角色为只读。
- 仪表盘图表库：使用 ECharts。
- 可参与活动定义：状态=已通过，且开始时间未到；并按部门/角色进行可见性过滤。
- 新增表单：默认使用弹窗；当字段复杂时跳转至独立页面。

### 12.7 变更（部门/社员/活动）

#### 12.7.1 部门管理（重构）
- 移除：顶部搜索/筛选/排序栏。
- 列表改为“卡片视图”，仅展示现有四个部门卡片；点击进入部门详情页：展示简介、成员列表、相关活动。
- 字段与数据来源调整：
  - dept 表新增 `intro VARCHAR(500)`（部门简介）。
  - 部门成员数不新增表字段，采用实时聚合：`SELECT dept.id, dept.name, COUNT(member.id) AS member_count ... GROUP BY dept.id`。
- 新增部门：仅填写“名称、简介”两项。

#### 12.7.2 社员管理（体验优化）
- 列表“部门ID”列改为“部门”，显示部门名称。
- 新增社员表单：将“部门ID”改为“部门选择”（下拉单选，与“角色”一致的选择体验）。

#### 12.7.3 活动管理（字段增强）
- 新增活动表单：
  - “负责人”由文本 ID 改为“搜索选择”（支持按姓名或学号检索 `sys_user` 中账号）。
  - 新增“活动简介 description”（文本，≤2000字）。
  - 新增“审批人 approvers”（多选，范围：指导老师或社长）。
- 活动支持进入“活动详情”页，展示简介、负责人、参与成员、审批人等信息。

#### 12.7.4 后端接口与数据模型影响
- dept：
  - 增加 `intro` 字段；提供“部门卡片列表”接口（含实时聚合成员数）；提供“部门详情”接口（含成员与活动概览）。
- member：
  - 列表返回中包含部门名称（后端联表或视图）；
  - 新增/更新接口接受 `deptId`，前端以下拉选择部门。
- activity：
  - 新增负责人检索接口（按姓名/学号模糊）；
  - 新增/更新接口支持 `description` 字段；
  - 审批人采用关系表：`activity_approver(id, activity_id, user_id, create_time)`；接口支持传入审批人ID数组以创建/更新关系。
  - 新增“活动详情”接口。

